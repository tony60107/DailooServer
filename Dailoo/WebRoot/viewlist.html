<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no"/>
    <title>鹿野帶路語音導覽  選擇主題</title>
    <meta name="Keywords" content="Dailoo, 帶路, 鹿野, 語音導覽, 導覽, 導遊, 高台散步, 鹿野品茶, 龍田逛逛">
    <meta name="Description" content="鹿野週邊語音導覽服務 - 就像導遊親自為您解說">
    <link rel="shortcut icon" href="images/general/dailoo.png">
    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/viewlist.css"/>
    <style>

    </style>
</head>
<body>
<div class="w">
    <div class="nav clearfix">
        <a id="backward" href="themelist.html">
            <img class="back fl" src="images/viewlist/back.png"/>
        </a>
        <div id="title" class="title" onclick="$$('drop').style.display = 'none'; themelist.style.display = 'block';"><span id="drop" class="drop"></span></div>
    </div>

    <div id="themelist" class="themelist">
        <!--div class="reply" onclick="$$('drop').style.display = 'inline-block'; themelist.style.display = 'none';"><img src="images/viewlist/reply.png"/></div-->
    </div>

    <div id="viewlist" class="viewlist clearfix">
    </div>
</div>
</div>
</body>
</html>
<iframe src="footer.html" id="footerIframe" width="100%" height="0" marginwidth="0" marginheight="0"
        scrolling="No" frameborder="0" style="margin-top: 48px;"></iframe>
<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<script language="javascript">

    var themeId = location.href.split("id=")[1];
    if(typeof themeId == 'undefined'){location.href = "/themelist.html?id=e3cfc0f0-a9f5-439b-a534-efff46ced2ce"}
    var themelist = $$("themelist");

    getViewpointsDataFromServer(themeId);

    //依據主題ID，從伺服器中獲取該景點下的景點
    function getViewpointsDataFromServer(themeId, themeName) {
        if(themeName != null) $$("title").innerHTML = themeName + '<span id="drop" class="drop"></span>';
        $.ajax({
            url: "/ViewpointServlet", context: document.body,
            type: "POST",
            data: {"method": "getViewpointSimplesByThemeIdAndPublish", "themeId": themeId},
            success: function (data) {
                var vps = eval("(" + data + ")");
                console.dir(vps);
                initDataFromServer(vps);
            },
        });
    }

    //獲取主題列表並新增到導航欄中
    $.ajax({
        url: "/ThemeServlet", context: document.body,
        type: "POST",
        data: {"method": "getThemesByThemeId", "id": themeId},
        success: function (data) {
            var themes = eval("(" + data + ")");
            console.dir(themes);
            for(var i = 0; i < themes.length; i++){
                var dom = '<div class="theme" onclick="getViewpointsDataFromServer(\''+ themes[i].id +'\',\'' + themes[i].name + '\');">' + themes[i].name + '</div>';
                themelist.innerHTML = themelist.innerHTML + dom;
                if(themes[i].id == themeId) {
                    $$("title").innerHTML = themes[i].name + '<span id="drop" class="drop"></span>';
                    $$("backward").href = "/themelist.html?id=" + themes[i].regionId;
                }
            }
            //增加返回按鈕
            themelist.innerHTML = themelist.innerHTML +  '<div class="reply" onclick="$$(\'drop\').style.display = \'inline-block\'; themelist.style.display = \'none\';"><img src="images/viewlist/reply.png"/></div>';
        },
    });

    history.replaceState(null, null, location.href);

    //將該主題的景點資料，新增到景點列表中
    function initDataFromServer(vps){
        themelist.style.display = "none";
        $$("viewlist").innerHTML = "";
        for(var i = 0; i < vps.length; i++) {
            var dom = '<a class="view" href="viewpoint.html?utm_source=InSite&utm_campaign='+ vps[i].name + '_' + vps[i].subtitle + '&id=' + vps[i].id +'">' +
                '<img src="/ResourceServlet?url=' + vps[i].behalfPhotoUrl + '">' +
                '<div class="cover"></div>' +
                '<div class="title">' + vps[i].name + '</div>' +
                '<img class="speaker-photo fl" src="/ResourceServlet?url='+ vps[i].speakerPhotoUrl +'" alt="">' +
                '<div class="fl">' +
                    '<div class="speaker">' + vps[i].speakerName + '</div>' +
                    '<div class="time">' + parseInt(vps[i].audioLength / 60) + '分' + vps[i].audioLength % 60 + '秒</div>' +
                '</div>' +
                '</a>';

            $$("viewlist").innerHTML = $$("viewlist").innerHTML + dom;
        }
    }


    //Google Analytics程式碼 開始
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-102968998-1', 'auto');
    ga('send', 'pageview');
    //Google Analytics程式碼 結束
</script>