<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>主題管理</title>
    <!-- 最新編譯和最佳化的 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <!-- 選擇性佈景主題 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- 最新編譯和最佳化的 JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/base.css">
    <style>
        /*主題列表開始*/
        .themelist {
            width: 100%;
        }

        .theme {
            position: relative;
        }

        .theme .cover {
            position: absolute;
            width: 980px;
            height: 232px;
            text-align: center;
            top: 72px;
            background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.2) 18%, rgba(0, 0, 0, 0.2) 85%, rgba(0, 0, 0, 0));
        }

        .theme .cover .main-title {
            margin-top: 24px;
            margin-left: 70px;
            line-height: 100px;
            font-size: 72px;
            letter-spacing: 25px;
            text-align: left;
            color: #ffffff;
        }

        .theme .cover .title-eng {
            margin-left: 70px;
            line-height: 90px;
            font-size: 64px;
            letter-spacing: 10px;
            text-align: left;
            color: #ffffff;
        }

        .themelist .theme {
            width: 100%;
            height: 304px;
            margin-top: 48px;
        }

        .themelist .theme img {
            width: 980px;
            height: 303px;
        }
        /*主題列表結束*/
    </style>
</head>
<body>
<div class="w">
    <div class="title" style="margin-top: 20px; text-align: center; font-size: 35px; line-height: 35px;">主題管理</div>
    <div id="header"></div>

    <form id="mainForm" action="/ThemeServlet?method=addTheme" method="post" enctype="multipart/form-data" style="margin-top: 80px;">
        <div class="form-group">
            <label>地區</label>
            <select id="regionSelect" type="text" name="regionId" class="form-control"></select>
        </div>
        <div class="form-group">
            <label>主題代表圖</label>
            <input type="file" name="file1" class="form-control"/>
        </div>
        <div class="form-group">
            <label>主題名稱</label>
            <input type="text" name="name" class="form-control"/>
        </div>
        <button class="btn btn-warning" type="submit" value="">新增</button>
    </form>
    <div id="themelist" class="themelist">
    </div>
</div>
</body>
</html>
<script type="text/javascript" src="js/base.js"></script>
<script>

    //獲取所有的地區，以取得地區下所有的主題
    $.ajax({
        url: "/RegionServlet", context: document.body,
        type: "POST",
        data: {"method": "getAllRegions"},
        success: function (data) {
            var regions = eval("(" + data + ")");
            console.dir(data);
            for(var i = 0; i < regions.length; i++){
                var dom = '<option value="'+ regions[i].id +'">' + regions[i].name +'</option>';
                $$("regionSelect").innerHTML = $$("regionSelect").innerHTML + dom;
            }
            $$("regionSelect").onchange();
        },
    });

    $$("regionSelect").onchange = function() {
        $.ajax({
            url: "/ThemeServlet", context: document.body,
            type: "POST",
            data: {"method": "getThemesByRegionId", "regionId": $$("regionSelect").value},
            success: function (data) {
                var themes = eval("(" + data + ")");
                console.dir(data);
                $$("themelist").innerHTML = "";
                for (var i = 0; i < themes.length; i++) {
                    var title = themes[i].name.split(",");
                    var dom = '<a href="viewlist.html?id=' + themes[i].id + '">' +
                            '<div class="theme">' +
                            '<div class="cover">' +
                            '<div class="main-title">' + title[0] + '</div>' +
                            '<div class="title-eng">' + (title[1] == undefined ? "" : title[1]) + '</div>' +
                            '</div>' +
                            '<img alt="" src="/ResourceServlet?url=' + themes[i].behalfPhotoUrl + '"/>' +
                            '</div>' +
                            '</a>' +
                            '<a href="/updateThemeInfo.html?id='+ themes[i].id +'"><button class="btn btn-warning fr">更新上方主題資訊</button></a>' +
                            '<a href="/ThemeServlet?method=delThemeById&id='+ themes[i].id +'"><button class="btn btn-danger fr">刪除上方主題</button></a>';

                    $$("themelist").innerHTML = $$("themelist").innerHTML + dom;
                }
            },
        });
    }

    //載入Header
    $.get("backHeader.html", function (data) {
        $("#header").html(data);
    });
</script>